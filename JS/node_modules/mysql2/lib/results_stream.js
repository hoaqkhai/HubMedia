'use strict';

const Readable = require('stream').Readable;

// copy-paste from https://github.com/mysqljs/mysql/blob/master/lib/protocol/sequences/Query.js
<<<<<<< HEAD
module.exports = function (command, connectionStream) {
  command.stream = function (options) {
=======
module.exports = function(command, connectionStream) {
  command.stream = function(options) {
>>>>>>> 5247a51d76e8a77a7e757084e5f84ee459ae7d98
    let stream;

    options = options || {};
    options.objectMode = true;
    (stream = new Readable(options)),
<<<<<<< HEAD
      (stream._read = function () {
        connectionStream.resume();
      });
=======
    (stream._read = function() {
      connectionStream.resume();
    });
>>>>>>> 5247a51d76e8a77a7e757084e5f84ee459ae7d98

    this.on('result', (row, i) => {
      if (!stream.push(row)) {
        connectionStream.pause();
      }
      stream.emit('result', row, i); // replicate old emitter
    });

<<<<<<< HEAD
    this.on('error', (err) => {
=======
    this.on('error', err => {
>>>>>>> 5247a51d76e8a77a7e757084e5f84ee459ae7d98
      stream.emit('error', err); // Pass on any errors
    });

    this.on('end', () => {
      stream.push(null); // pushing null, indicating EOF
    });

    this.on('fields', (fields, i) => {
      stream.emit('fields', fields, i); // replicate old emitter
    });

    return stream;
  };
};
